{"version":3,"sources":["direct_dom_renderer.js"],"names":[],"mappings":"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","file":"angular2/src/render/dom/direct_dom_renderer.js","sourcesContent":["import {Injectable} from 'angular2/di';\nimport {Promise, PromiseWrapper} from 'angular2/src/facade/async';\nimport {List, ListWrapper} from 'angular2/src/facade/collection';\nimport {isBlank, isPresent} from 'angular2/src/facade/lang';\n\nimport * as api from '../api';\nimport {RenderView} from './view/view';\nimport {RenderProtoView} from './view/proto_view';\nimport {ViewFactory} from './view/view_factory';\nimport {Compiler} from './compiler/compiler';\nimport {ShadowDomStrategy} from './shadow_dom/shadow_dom_strategy';\nimport {ProtoViewBuilder} from './view/proto_view_builder';\n\nfunction _resolveViewContainer(vc:api.ViewContainerRef) {\n  return _resolveView(vc.view).viewContainers[vc.elementIndex];\n}\n\nfunction _resolveView(viewRef:DirectDomViewRef) {\n  return isPresent(viewRef) ? viewRef.delegate : null;\n}\n\nfunction _resolveProtoView(protoViewRef:DirectDomProtoViewRef) {\n  return isPresent(protoViewRef) ? protoViewRef.delegate : null;\n}\n\nfunction _wrapView(view:RenderView) {\n  return new DirectDomViewRef(view);\n}\n\nfunction _collectComponentChildViewRefs(view, target = null) {\n  if (isBlank(target)) {\n    target = [];\n  }\n  ListWrapper.push(target, _wrapView(view));\n  ListWrapper.forEach(view.componentChildViews, (view) => {\n    if (isPresent(view)) {\n      _collectComponentChildViewRefs(view, target);\n    }\n  });\n  return target;\n}\n\n\n\n// public so that the compiler can use it.\nexport class DirectDomProtoViewRef extends api.ProtoViewRef {\n  delegate:RenderProtoView;\n\n  constructor(delegate:RenderProtoView) {\n    super();\n    this.delegate = delegate;\n  }\n}\n\nexport class DirectDomViewRef extends api.ViewRef {\n  delegate:RenderView;\n\n  constructor(delegate:RenderView) {\n    super();\n    this.delegate = delegate;\n  }\n}\n\n@Injectable()\nexport class DirectDomRenderer extends api.Renderer {\n  _compiler: Compiler;\n  _viewFactory: ViewFactory;\n  _shadowDomStrategy: ShadowDomStrategy;\n\n  constructor(\n      compiler: Compiler, viewFactory: ViewFactory, shadowDomStrategy: ShadowDomStrategy) {\n    super();\n    this._compiler = compiler;\n    this._viewFactory = viewFactory;\n    this._shadowDomStrategy = shadowDomStrategy;\n  }\n\n  compile(template:api.ViewDefinition):Promise<api.ProtoViewDto> {\n    // Note: compiler already uses a DirectDomProtoViewRef, so we don't\n    // need to do anything here\n    return this._compiler.compile(template);\n  }\n\n  mergeChildComponentProtoViews(protoViewRef:api.ProtoViewRef, protoViewRefs:List<api.ProtoViewRef>) {\n    _resolveProtoView(protoViewRef).mergeChildComponentProtoViews(\n      ListWrapper.map(protoViewRefs, _resolveProtoView)\n    );\n  }\n\n  createRootProtoView(selectorOrElement, componentId):Promise<api.ProtoViewDto> {\n    var element = selectorOrElement; // TODO: select the element if it is not a real element...\n    var rootProtoViewBuilder = new ProtoViewBuilder(element);\n    rootProtoViewBuilder.setIsRootView(true);\n    var elBinder = rootProtoViewBuilder.bindElement(element, 'root element');\n    elBinder.setComponentId(componentId);\n    elBinder.bindDirective(0);\n\n    this._shadowDomStrategy.processElement(null, componentId, element);\n    return PromiseWrapper.resolve(rootProtoViewBuilder.build());\n  }\n\n  createView(protoViewRef:api.ProtoViewRef):List<api.ViewRef> {\n    return _collectComponentChildViewRefs(\n      this._viewFactory.getView(_resolveProtoView(protoViewRef))\n    );\n  }\n\n  destroyView(viewRef:api.ViewRef) {\n    this._viewFactory.returnView(_resolveView(viewRef));\n  }\n\n  insertViewIntoContainer(vcRef:api.ViewContainerRef, viewRef:api.ViewRef, atIndex=-1):void {\n    _resolveViewContainer(vcRef).insert(_resolveView(viewRef), atIndex);\n  }\n\n  detachViewFromContainer(vcRef:api.ViewContainerRef, atIndex:number):void {\n    _resolveViewContainer(vcRef).detach(atIndex);\n  }\n\n  setElementProperty(viewRef:api.ViewRef, elementIndex:number, propertyName:string, propertyValue:any):void {\n    _resolveView(viewRef).setElementProperty(elementIndex, propertyName, propertyValue);\n  }\n\n  setDynamicComponentView(viewRef:api.ViewRef, elementIndex:number, nestedViewRef:api.ViewRef):void {\n    _resolveView(viewRef).setComponentView(\n      this._shadowDomStrategy,\n      elementIndex,\n      _resolveView(nestedViewRef)\n    );\n  }\n\n  setText(viewRef:api.ViewRef, textNodeIndex:number, text:string):void {\n    _resolveView(viewRef).setText(textNodeIndex, text);\n  }\n\n  setEventDispatcher(viewRef:api.ViewRef, dispatcher:any/*api.EventDispatcher*/):void {\n    _resolveView(viewRef).setEventDispatcher(dispatcher);\n  }\n}\n"]}