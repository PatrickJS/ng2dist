{"version":3,"sources":["compiler.js"],"names":[],"mappings":"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","file":"angular2/src/render/dom/compiler/compiler.js","sourcesContent":["import {Injectable} from 'angular2/di';\n\nimport {PromiseWrapper, Promise} from 'angular2/src/facade/async';\nimport {BaseException} from 'angular2/src/facade/lang';\n\nimport {ViewDefinition, ProtoViewDto} from '../../api';\nimport {CompilePipeline} from './compile_pipeline';\nimport {TemplateLoader} from 'angular2/src/render/dom/compiler/template_loader';\nimport {CompileStepFactory, DefaultStepFactory} from './compile_step_factory';\nimport {Parser} from 'angular2/change_detection';\nimport {ShadowDomStrategy} from '../shadow_dom/shadow_dom_strategy';\n\n/**\n * The compiler loads and translates the html templates of components into\n * nested ProtoViews. To decompose its functionality it uses\n * the CompilePipeline and the CompileSteps.\n */\nexport class Compiler {\n  _templateLoader: TemplateLoader;\n  _stepFactory: CompileStepFactory;\n\n  constructor(stepFactory: CompileStepFactory, templateLoader: TemplateLoader) {\n    this._templateLoader = templateLoader;\n    this._stepFactory = stepFactory;\n  }\n\n  compile(template: ViewDefinition):Promise<ProtoViewDto> {\n    var tplPromise = this._templateLoader.load(template);\n    return PromiseWrapper.then(tplPromise,\n      (el) => this._compileTemplate(template, el),\n      (_) => { throw new BaseException(`Failed to load the template \"${template.componentId}\"`); }\n    );\n  }\n\n  _compileTemplate(template: ViewDefinition, tplElement):Promise<ProtoViewDto> {\n    var subTaskPromises = [];\n    var pipeline = new CompilePipeline(this._stepFactory.createSteps(template, subTaskPromises));\n    var compileElements;\n\n    compileElements = pipeline.process(tplElement, template.componentId);\n\n    var protoView = compileElements[0].inheritedProtoView.build();\n\n    if (subTaskPromises.length > 0) {\n      return PromiseWrapper.all(subTaskPromises).then((_) => protoView);\n    } else {\n      return PromiseWrapper.resolve(protoView);\n    }\n  }\n}\n\n@Injectable()\nexport class DefaultCompiler extends Compiler {\n  constructor(parser:Parser, shadowDomStrategy:ShadowDomStrategy, templateLoader: TemplateLoader) {\n    super(new DefaultStepFactory(parser, shadowDomStrategy), templateLoader);\n  }\n}\n"]}