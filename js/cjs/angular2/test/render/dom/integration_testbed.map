{"version":3,"sources":["integration_testbed.js"],"names":[],"mappings":"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","file":"angular2/test/render/dom/integration_testbed.js","sourcesContent":["import {isBlank, isPresent, BaseException} from 'angular2/src/facade/lang';\nimport {MapWrapper, ListWrapper, List, Map} from 'angular2/src/facade/collection';\nimport {PromiseWrapper, Promise} from 'angular2/src/facade/async';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nimport {Parser, Lexer} from 'angular2/change_detection';\nimport {DirectDomRenderer} from 'angular2/src/render/dom/direct_dom_renderer';\nimport {Compiler} from 'angular2/src/render/dom/compiler/compiler';\nimport {ProtoViewRef, ProtoViewDto, ViewDefinition, ViewContainerRef, EventDispatcher, DirectiveMetadata} from 'angular2/src/render/api';\nimport {DefaultStepFactory} from 'angular2/src/render/dom/compiler/compile_step_factory';\nimport {TemplateLoader} from 'angular2/src/render/dom/compiler/template_loader';\nimport {UrlResolver} from 'angular2/src/services/url_resolver';\nimport {EmulatedUnscopedShadowDomStrategy} from 'angular2/src/render/dom/shadow_dom/emulated_unscoped_shadow_dom_strategy';\nimport {EventManager, EventManagerPlugin} from 'angular2/src/render/dom/events/event_manager';\nimport {VmTurnZone} from 'angular2/src/core/zone/vm_turn_zone';\nimport {StyleUrlResolver} from 'angular2/src/render/dom/shadow_dom/style_url_resolver';\nimport {ViewFactory} from 'angular2/src/render/dom/view/view_factory';\n\nexport class IntegrationTestbed {\n  renderer;\n  parser;\n  eventPlugin;\n  _templates:Map<string, ViewDefinition>;\n\n  constructor({urlData, viewCacheCapacity, shadowDomStrategy, templates}) {\n    this._templates = MapWrapper.create();\n    if (isPresent(templates)) {\n      ListWrapper.forEach(templates, (template) => {\n        MapWrapper.set(this._templates, template.componentId, template);\n      });\n    }\n    var parser = new Parser(new Lexer());\n    var urlResolver = new UrlResolver();\n    if (isBlank(shadowDomStrategy)) {\n      shadowDomStrategy = new EmulatedUnscopedShadowDomStrategy(new StyleUrlResolver(urlResolver), null);\n    }\n    var compiler = new Compiler(new DefaultStepFactory(parser, shadowDomStrategy), new FakeTemplateLoader(urlResolver, urlData));\n\n    if (isBlank(viewCacheCapacity)) {\n      viewCacheCapacity = 1;\n    }\n    if (isBlank(urlData)) {\n      urlData = MapWrapper.create();\n    }\n    this.eventPlugin = new FakeEventManagerPlugin();\n    var eventManager = new EventManager([this.eventPlugin], new FakeVmTurnZone());\n    var viewFactory = new ViewFactory(viewCacheCapacity, eventManager, shadowDomStrategy);\n    this.renderer = new DirectDomRenderer(compiler, viewFactory, shadowDomStrategy);\n  }\n\n  compileRoot(rootEl, componentId):Promise<ProtoViewDto> {\n    return this.renderer.createRootProtoView(rootEl, componentId).then( (rootProtoView) => {\n      return this._compileNestedProtoViews(rootProtoView, [\n        new DirectiveMetadata({\n          type: DirectiveMetadata.COMPONENT_TYPE,\n          id: componentId\n        })\n      ]);\n    });\n  }\n\n  compile(componentId):Promise<ProtoViewDto> {\n    var childTemplate = MapWrapper.get(this._templates, componentId);\n    if (isBlank(childTemplate)) {\n      throw new BaseException(`No template for component ${componentId}`);\n    }\n    return this.renderer.compile(childTemplate).then( (protoView) => {\n      return this._compileNestedProtoViews(protoView, childTemplate.directives);\n    });\n  }\n\n  _compileNestedProtoViews(protoView, directives):Promise<ProtoViewDto> {\n    var childComponentRenderPvRefs = [];\n    var nestedPVPromises = [];\n    ListWrapper.forEach(protoView.elementBinders, (elementBinder) => {\n      var nestedComponentId = null;\n      ListWrapper.forEach(elementBinder.directives, (db) => {\n        var directiveMeta = directives[db.directiveIndex];\n        if (directiveMeta.type === DirectiveMetadata.COMPONENT_TYPE) {\n          nestedComponentId = directiveMeta.id;\n        }\n      });\n      var nestedCall;\n      if (isPresent(nestedComponentId)) {\n        var childTemplate = MapWrapper.get(this._templates, nestedComponentId);\n        if (isBlank(childTemplate)) {\n          // dynamic component\n          ListWrapper.push(childComponentRenderPvRefs, null);\n        } else {\n          nestedCall = this.compile(nestedComponentId);\n        }\n      } else if (isPresent(elementBinder.nestedProtoView)) {\n        nestedCall = this._compileNestedProtoViews(elementBinder.nestedProtoView, directives);\n      }\n      if (isPresent(nestedCall)) {\n        ListWrapper.push(\n          nestedPVPromises,\n          nestedCall.then( (nestedPv) => {\n            elementBinder.nestedProtoView = nestedPv;\n            if (isPresent(nestedComponentId)) {\n              ListWrapper.push(childComponentRenderPvRefs, nestedPv.render);\n            }\n          })\n        );\n      }\n    });\n    if (nestedPVPromises.length > 0) {\n      return PromiseWrapper.all(nestedPVPromises).then((_) => {\n        this.renderer.mergeChildComponentProtoViews(protoView.render, childComponentRenderPvRefs);\n        return protoView;\n      });\n    } else {\n      return PromiseWrapper.resolve(protoView);\n    }\n  }\n\n}\n\n\nclass FakeTemplateLoader extends TemplateLoader {\n  _urlData: Map<string, string>;\n\n  constructor(urlResolver, urlData) {\n    super(null, urlResolver);\n    this._urlData = urlData;\n  }\n\n  load(template: ViewDefinition) {\n    if (isPresent(template.template)) {\n      return PromiseWrapper.resolve(DOM.createTemplate(template.template));\n    }\n\n    if (isPresent(template.absUrl)) {\n      var content = this._urlData[template.absUrl];\n      if (isPresent(content)) {\n        return PromiseWrapper.resolve(DOM.createTemplate(content));\n      }\n    }\n\n    return PromiseWrapper.reject('Load failed');\n  }\n}\n\nexport class FakeVmTurnZone extends VmTurnZone {\n  constructor() {\n    super({enableLongStackTrace: false});\n  }\n\n  run(fn) {\n    fn();\n  }\n\n  runOutsideAngular(fn) {\n    fn();\n  }\n}\n\nexport class FakeEventManagerPlugin extends EventManagerPlugin {\n  _eventHandlers: Map;\n\n  constructor() {\n    super();\n    this._eventHandlers = MapWrapper.create();\n  }\n\n  dispatchEvent(eventName, event) {\n    MapWrapper.get(this._eventHandlers, eventName)(event);\n  }\n\n  supports(eventName: string): boolean {\n    return true;\n  }\n\n  addEventListener(element, eventName: string, handler: Function, shouldSupportBubble: boolean) {\n    MapWrapper.set(this._eventHandlers, eventName, handler);\n    return () => {MapWrapper.delete(this._eventHandlers, eventName);}\n  }\n}\n\nexport class LoggingEventDispatcher extends EventDispatcher {\n  log:List;\n  constructor() {\n    super();\n    this.log = [];\n  }\n  dispatchEvent(\n    elementIndex:number, eventName:string, locals:Map<string, any>\n  ) {\n    ListWrapper.push(this.log, [elementIndex, eventName, locals]);\n  }\n}\n\nexport class FakeEvent {\n  target;\n  constructor(target) {\n    this.target = target;\n  }\n}\n"]}