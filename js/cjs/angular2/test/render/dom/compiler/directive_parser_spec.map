{"version":3,"sources":["directive_parser_spec.js"],"names":[],"mappings":"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","file":"angular2/test/render/dom/compiler/directive_parser_spec.js","sourcesContent":["import {describe, beforeEach, it, xit, expect, iit, ddescribe, el} from 'angular2/test_lib';\nimport {isPresent, assertionsEnabled} from 'angular2/src/facade/lang';\nimport {ListWrapper, MapWrapper, StringMapWrapper} from 'angular2/src/facade/collection';\nimport {DirectiveParser} from 'angular2/src/render/dom/compiler/directive_parser';\nimport {CompilePipeline} from 'angular2/src/render/dom/compiler/compile_pipeline';\nimport {CompileStep} from 'angular2/src/render/dom/compiler/compile_step';\nimport {CompileElement} from 'angular2/src/render/dom/compiler/compile_element';\nimport {CompileControl} from 'angular2/src/render/dom/compiler/compile_control';\nimport {ViewDefinition, DirectiveMetadata} from 'angular2/src/render/api';\nimport {Lexer, Parser} from 'angular2/change_detection';\n\nexport function main() {\n  describe('DirectiveParser', () => {\n    var parser, annotatedDirectives;\n\n    beforeEach( () => {\n      annotatedDirectives = [\n        someComponent,\n        someComponent2,\n        someComponent3,\n        someViewport,\n        someViewport2,\n        someDecorator,\n        someDecoratorIgnoringChildren,\n        someDecoratorWithProps,\n        someDecoratorWithEvents,\n        someDecoratorWithGlobalEvents\n      ];\n      parser = new Parser(new Lexer());\n    });\n\n    function createPipeline(propertyBindings = null) {\n      return new CompilePipeline([\n        new MockStep( (parent, current, control) => {\n          if (isPresent(propertyBindings)) {\n            StringMapWrapper.forEach(propertyBindings, (ast, name) => {\n              current.bindElement().bindProperty(name, ast);\n            });\n          }\n        }),\n        new DirectiveParser(parser, annotatedDirectives)\n      ]);\n    }\n\n    function process(el, propertyBindings = null) {\n      var pipeline = createPipeline(propertyBindings);\n      return ListWrapper.map(pipeline.process(el), (ce) => ce.inheritedElementBinder );\n    }\n\n    it('should not add directives if they are not used', () => {\n      var results = process(el('<div></div>'));\n      expect(results[0]).toBe(null);\n    });\n\n    it('should detect directives in attributes', () => {\n      var results = process(el('<div some-decor></div>'));\n      expect(results[0].directives[0].directiveIndex).toBe(\n        annotatedDirectives.indexOf(someDecorator)\n      );\n    });\n\n    it('should detect directives with multiple attributes', () => {\n      var results = process(el('<input type=text control=one></input>'));\n      expect(results[0].directives[0].directiveIndex).toBe(\n        annotatedDirectives.indexOf(someComponent3)\n      );\n    });\n\n    it('should compile children by default', () => {\n      var results = createPipeline().process(el('<div some-decor></div>'));\n      expect(results[0].compileChildren).toEqual(true);\n    });\n\n    it('should stop compiling children when specified in the directive config', () => {\n      var results = createPipeline().process(el('<div some-decor-ignoring-children></div>'));\n      expect(results[0].compileChildren).toEqual(false);\n    });\n\n    it('should bind directive properties from bound properties', () => {\n      var results = process(\n        el('<div some-decor-props></div>'),\n        {\n          'elProp': parser.parseBinding('someExpr', '')\n        }\n      );\n      var directiveBinding = results[0].directives[0];\n      expect(MapWrapper.get(directiveBinding.propertyBindings, 'dirProp').source)\n        .toEqual('someExpr');\n    });\n\n    it('should bind directive properties with pipes', () => {\n      var results = process(\n        el('<div some-decor-props></div>'),\n        {\n          'elProp': parser.parseBinding('someExpr', '')\n        }\n      );\n      var directiveBinding = results[0].directives[0];\n      var pipedProp = MapWrapper.get(directiveBinding.propertyBindings, 'doubleProp');\n      var simpleProp = MapWrapper.get(directiveBinding.propertyBindings, 'dirProp');\n      expect(pipedProp.ast.name).toEqual('double');\n      expect(pipedProp.ast.exp).toEqual(simpleProp.ast);\n      expect(simpleProp.source).toEqual('someExpr');\n    });\n\n    it('should bind directive properties from attribute values', () => {\n      var results = process(\n        el('<div some-decor-props el-prop=\"someValue\"></div>')\n      );\n      var directiveBinding = results[0].directives[0];\n      var simpleProp = MapWrapper.get(directiveBinding.propertyBindings, 'dirProp');\n      expect(simpleProp.source).toEqual('someValue');\n    });\n\n    it('should store working property setters', () => {\n      var element = el('<input some-decor-props>');\n      var results = process(element);\n      var setter = MapWrapper.get(results[0].propertySetters, 'value');\n      setter(element, 'abc');\n      expect(element.value).toEqual('abc');\n    });\n\n    it('should read attribute values', () => {\n      var element = el('<input some-decor-props some-attr=\"someValue\">');\n      var results = process(element);\n      expect(MapWrapper.get(results[0].readAttributes, 'some-attr')).toEqual('someValue');\n    });\n\n    it('should bind directive events', () => {\n      var results = process(\n        el('<div some-decor-events></div>')\n      );\n      var directiveBinding = results[0].directives[0];\n      expect(directiveBinding.eventBindings.length).toEqual(1);\n      var eventBinding = directiveBinding.eventBindings[0];\n      expect(eventBinding.fullName).toEqual('click');\n      expect(eventBinding.source.source).toEqual('doIt()');\n    });\n\n    it('should bind directive global events', () => {\n      var results = process(\n        el('<div some-decor-globalevents></div>')\n      );\n      var directiveBinding = results[0].directives[0];\n      expect(directiveBinding.eventBindings.length).toEqual(1);\n      var eventBinding = directiveBinding.eventBindings[0];\n      expect(eventBinding.fullName).toEqual('window:resize');\n      expect(eventBinding.source.source).toEqual('doItGlobal()');\n    });\n\n    describe('viewport directives', () => {\n      it('should not allow multiple viewport directives on the same element', () => {\n        expect( () => {\n          process(\n            el('<template some-vp some-vp2></template>')\n          );\n        }).toThrowError('Only one viewport directive is allowed per element - check <template some-vp some-vp2>');\n      });\n\n      it('should not allow viewport directives on non <template> elements', () => {\n        expect( () => {\n          process(\n            el('<div some-vp></div>')\n          );\n        }).toThrowError('Viewport directives need to be placed on <template> elements or elements with template attribute - check <div some-vp>');\n      });\n    });\n\n    describe('component directives', () => {\n      it('should save the component id', () => {\n        var results = process(\n          el('<div some-comp></div>')\n        );\n        expect(results[0].componentId).toEqual('someComponent');\n      });\n\n      it('should not allow multiple component directives on the same element', () => {\n         expect( () => {\n           process(\n             el('<div some-comp some-comp2></div>')\n           );\n         }).toThrowError('Only one component directive is allowed per element - check <div some-comp some-comp2>');\n      });\n\n      it('should not allow component directives on <template> elements', () => {\n         expect( () => {\n           process(\n             el('<template some-comp></template>')\n           );\n         }).toThrowError('Only template directives are allowed on template elements - check <template some-comp>');\n       });\n    });\n\n  });\n}\n\nclass MockStep extends CompileStep {\n  processClosure:Function;\n  constructor(process) {\n    super();\n    this.processClosure = process;\n  }\n  process(parent:CompileElement, current:CompileElement, control:CompileControl) {\n    this.processClosure(parent, current, control);\n  }\n}\n\nvar someComponent = new DirectiveMetadata({\n  selector: '[some-comp]',\n  id: 'someComponent',\n  type: DirectiveMetadata.COMPONENT_TYPE\n});\n\nvar someComponent2 = new DirectiveMetadata({\n  selector: '[some-comp2]',\n  id: 'someComponent2',\n  type: DirectiveMetadata.COMPONENT_TYPE\n});\n\nvar someComponent3 = new DirectiveMetadata({\n  selector: 'input[type=text][control]',\n  id: 'someComponent3',\n  type: DirectiveMetadata.COMPONENT_TYPE\n});\n\nvar someViewport = new DirectiveMetadata({\n  selector: '[some-vp]',\n  id: 'someViewport',\n  type: DirectiveMetadata.VIEWPORT_TYPE\n});\n\nvar someViewport2 = new DirectiveMetadata({\n  selector: '[some-vp2]',\n  id: 'someViewport2',\n  type: DirectiveMetadata.VIEWPORT_TYPE\n});\n\nvar someDecorator = new DirectiveMetadata({\n  selector: '[some-decor]'\n});\n\nvar someDecoratorIgnoringChildren = new DirectiveMetadata({\n  selector: '[some-decor-ignoring-children]',\n  compileChildren: false\n});\n\nvar someDecoratorWithProps = new DirectiveMetadata({\n  selector: '[some-decor-props]',\n  properties: MapWrapper.createFromStringMap({\n    'dirProp': 'elProp',\n    'doubleProp': 'elProp | double'\n  }),\n  setters: ['value'],\n  readAttributes: ['some-attr']\n});\n\nvar someDecoratorWithEvents = new DirectiveMetadata({\n  selector: '[some-decor-events]',\n  hostListeners: MapWrapper.createFromStringMap({\n    'click': 'doIt()'\n  })\n});\n\nvar someDecoratorWithGlobalEvents = new DirectiveMetadata({\n  selector: '[some-decor-globalevents]',\n  hostListeners: MapWrapper.createFromStringMap({\n    'window:resize': 'doItGlobal()'\n  })\n});\n"]}