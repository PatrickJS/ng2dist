{"version":3,"sources":["chrome_driver_extension.es6"],"names":[],"mappings":"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","file":"benchpress/src/webdriver/chrome_driver_extension.js","sourcesContent":["import {assert} from \"rtts_assert/rtts_assert\";\nimport {bind} from 'angular2/di';\nimport {ListWrapper,\n  StringMapWrapper,\n  StringMap} from 'angular2/src/facade/collection';\nimport {Json,\n  isPresent,\n  isBlank,\n  RegExpWrapper,\n  StringWrapper,\n  BaseException,\n  NumberWrapper} from 'angular2/src/facade/lang';\nimport {WebDriverExtension,\n  PerfLogFeatures} from '../web_driver_extension';\nimport {WebDriverAdapter} from '../web_driver_adapter';\nimport {Promise} from 'angular2/src/facade/async';\nexport class ChromeDriverExtension extends WebDriverExtension {\n  static get BINDINGS() {\n    return _BINDINGS;\n  }\n  constructor(driver) {\n    assert.argumentTypes(driver, WebDriverAdapter);\n    super();\n    this._driver = driver;\n  }\n  gc() {\n    return this._driver.executeScript('window.gc()');\n  }\n  timeBegin(name) {\n    assert.argumentTypes(name, assert.type.string);\n    return assert.returnType((this._driver.executeScript(`console.time('${name}');`)), Promise);\n  }\n  timeEnd(name, restartName = null) {\n    assert.argumentTypes(name, assert.type.string, restartName, assert.type.string);\n    var script = `console.timeEnd('${name}');`;\n    if (isPresent(restartName)) {\n      script += `console.time('${restartName}');`;\n    }\n    return assert.returnType((this._driver.executeScript(script)), Promise);\n  }\n  readPerfLog() {\n    return this._driver.executeScript('1+1').then((_) => this._driver.logs('performance')).then((entries) => {\n      var events = [];\n      ListWrapper.forEach(entries, function(entry) {\n        var message = Json.parse(entry['message'])['message'];\n        if (StringWrapper.equals(message['method'], 'Tracing.dataCollected')) {\n          ListWrapper.push(events, message['params']);\n        }\n        if (StringWrapper.equals(message['method'], 'Tracing.bufferUsage')) {\n          throw new BaseException('The DevTools trace buffer filled during the test!');\n        }\n      });\n      return this._convertPerfRecordsToEvents(events);\n    });\n  }\n  _convertPerfRecordsToEvents(chromeEvents, normalizedEvents = null) {\n    if (isBlank(normalizedEvents)) {\n      normalizedEvents = [];\n    }\n    var majorGCPids = {};\n    chromeEvents.forEach((event) => {\n      var cat = event['cat'];\n      var name = event['name'];\n      var args = event['args'];\n      var pid = event['pid'];\n      var ph = event['ph'];\n      if (StringWrapper.equals(cat, 'disabled-by-default-devtools.timeline')) {\n        if (StringWrapper.equals(name, 'FunctionCall') && (isBlank(args) || isBlank(args['data']) || !StringWrapper.equals(args['data']['scriptName'], 'InjectedScript'))) {\n          ListWrapper.push(normalizedEvents, normalizeEvent(event, {'name': 'script'}));\n        } else if (StringWrapper.equals(name, 'RecalculateStyles') || StringWrapper.equals(name, 'Layout') || StringWrapper.equals(name, 'UpdateLayerTree') || StringWrapper.equals(name, 'Paint') || StringWrapper.equals(name, 'Rasterize') || StringWrapper.equals(name, 'CompositeLayers')) {\n          ListWrapper.push(normalizedEvents, normalizeEvent(event, {'name': 'render'}));\n        } else if (StringWrapper.equals(name, 'GCEvent')) {\n          var normArgs = {'usedHeapSize': isPresent(args['usedHeapSizeAfter']) ? args['usedHeapSizeAfter'] : args['usedHeapSizeBefore']};\n          if (StringWrapper.equals(event['ph'], 'E')) {\n            normArgs['majorGc'] = isPresent(majorGCPids[pid]) && majorGCPids[pid];\n          }\n          majorGCPids[pid] = false;\n          ListWrapper.push(normalizedEvents, normalizeEvent(event, {\n            'name': 'gc',\n            'args': normArgs\n          }));\n        }\n      } else if (StringWrapper.equals(cat, 'blink.console')) {\n        ListWrapper.push(normalizedEvents, normalizeEvent(event, {'name': name}));\n      } else if (StringWrapper.equals(cat, 'v8')) {\n        if (StringWrapper.equals(name, 'majorGC')) {\n          if (StringWrapper.equals(ph, 'B')) {\n            majorGCPids[pid] = true;\n          }\n        }\n      }\n    });\n    return normalizedEvents;\n  }\n  perfLogFeatures() {\n    return assert.returnType((new PerfLogFeatures({\n      render: true,\n      gc: true\n    })), PerfLogFeatures);\n  }\n  supports(capabilities) {\n    assert.argumentTypes(capabilities, StringMap);\n    return assert.returnType((StringWrapper.equals(capabilities['browserName'].toLowerCase(), 'chrome')), assert.type.boolean);\n  }\n}\nObject.defineProperty(ChromeDriverExtension, \"parameters\", {get: function() {\n    return [[WebDriverAdapter]];\n  }});\nObject.defineProperty(ChromeDriverExtension.prototype.timeBegin, \"parameters\", {get: function() {\n    return [[assert.type.string]];\n  }});\nObject.defineProperty(ChromeDriverExtension.prototype.timeEnd, \"parameters\", {get: function() {\n    return [[assert.type.string], [assert.type.string]];\n  }});\nObject.defineProperty(ChromeDriverExtension.prototype.supports, \"parameters\", {get: function() {\n    return [[StringMap]];\n  }});\nfunction normalizeEvent(chromeEvent, data) {\n  var ph = chromeEvent['ph'];\n  if (StringWrapper.equals(ph, 'S')) {\n    ph = 'b';\n  } else if (StringWrapper.equals(ph, 'F')) {\n    ph = 'e';\n  }\n  var result = {\n    'pid': chromeEvent['pid'],\n    'ph': ph,\n    'cat': 'timeline',\n    'ts': chromeEvent['ts'] / 1000\n  };\n  if (chromeEvent['ph'] === 'X') {\n    var dur = chromeEvent['dur'];\n    if (isBlank(dur)) {\n      dur = chromeEvent['tdur'];\n    }\n    result['dur'] = isBlank(dur) ? 0.0 : dur / 1000;\n  }\n  StringMapWrapper.forEach(data, (value, prop) => {\n    result[prop] = value;\n  });\n  return result;\n}\nvar _BINDINGS = [bind(ChromeDriverExtension).toFactory((driver) => new ChromeDriverExtension(driver), [WebDriverAdapter])];\n//# sourceMappingURL=chrome_driver_extension.js.map\n\n//# sourceMappingURL=./chrome_driver_extension.map"]}