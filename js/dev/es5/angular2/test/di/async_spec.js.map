{"version":3,"sources":["async_spec.es6"],"names":[],"mappings":"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","file":"angular2/test/di/async_spec.js","sourcesContent":["import {assert} from \"rtts_assert/rtts_assert\";\nimport {AsyncTestCompleter,\n  beforeEach,\n  ddescribe,\n  describe,\n  expect,\n  iit,\n  inject,\n  it,\n  xit} from 'angular2/test_lib';\nimport {Injector,\n  Inject,\n  InjectPromise,\n  bind,\n  Key} from 'angular2/di';\nimport {Promise,\n  PromiseWrapper} from 'angular2/src/facade/async';\nclass UserList {}\nfunction fetchUsers() {\n  return PromiseWrapper.resolve(new UserList());\n}\nclass SynchronousUserList {}\nclass UserController {\n  constructor(list) {\n    assert.argumentTypes(list, UserList);\n    this.list = list;\n  }\n}\nObject.defineProperty(UserController, \"parameters\", {get: function() {\n    return [[UserList]];\n  }});\nclass AsyncUserController {\n  constructor(userList) {\n    this.userList = userList;\n  }\n}\nObject.defineProperty(AsyncUserController, \"parameters\", {get: function() {\n    return [[new InjectPromise(UserList)]];\n  }});\nexport function main() {\n  describe(\"async injection\", function() {\n    describe(\"asyncGet\", function() {\n      it('should return a promise', function() {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers)]);\n        var p = injector.asyncGet(UserList);\n        expect(p).toBePromise();\n      });\n      it('should return a promise when the binding is sync', function() {\n        var injector = Injector.resolveAndCreate([SynchronousUserList]);\n        var p = injector.asyncGet(SynchronousUserList);\n        expect(p).toBePromise();\n      });\n      it(\"should return a promise when the binding is sync (from cache)\", function() {\n        var injector = Injector.resolveAndCreate([UserList]);\n        expect(injector.get(UserList)).toBeAnInstanceOf(UserList);\n        expect(injector.asyncGet(UserList)).toBePromise();\n      });\n      it('should return the injector', inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([]);\n        var p = injector.asyncGet(Injector);\n        p.then(function(injector) {\n          expect(injector).toBe(injector);\n          async.done();\n        });\n      }));\n      it('should return a promise when instantiating a sync binding ' + 'with an async dependency', inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers), UserController]);\n        injector.asyncGet(UserController).then(function(userController) {\n          expect(userController).toBeAnInstanceOf(UserController);\n          expect(userController.list).toBeAnInstanceOf(UserList);\n          async.done();\n        });\n      }));\n      it(\"should create only one instance (async + async)\", inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers)]);\n        var ul1 = injector.asyncGet(UserList);\n        var ul2 = injector.asyncGet(UserList);\n        PromiseWrapper.all([ul1, ul2]).then(function(uls) {\n          expect(uls[0]).toBe(uls[1]);\n          async.done();\n        });\n      }));\n      it(\"should create only one instance (sync + async)\", inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([UserList]);\n        var promise = injector.asyncGet(UserList);\n        var ul = injector.get(UserList);\n        expect(promise).toBePromise();\n        expect(ul).toBeAnInstanceOf(UserList);\n        promise.then(function(ful) {\n          expect(ful).toBe(ul);\n          async.done();\n        });\n      }));\n      it('should show the full path when error happens in a constructor', inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([UserController, bind(UserList).toAsyncFactory(function() {\n          throw \"Broken UserList\";\n        })]);\n        var promise = injector.asyncGet(UserController);\n        PromiseWrapper.then(promise, null, function(e) {\n          expect(e.message).toContain(\"Error during instantiation of UserList! (UserController -> UserList)\");\n          async.done();\n        });\n      }));\n    });\n    describe(\"get\", function() {\n      it('should throw when instantiating an async binding', function() {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers)]);\n        expect(() => injector.get(UserList)).toThrowError('Cannot instantiate UserList synchronously. It is provided as a promise!');\n      });\n      it('should throw when instantiating a sync binding with an async dependency', function() {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers), UserController]);\n        expect(() => injector.get(UserController)).toThrowError('Cannot instantiate UserList synchronously. It is provided as a promise! (UserController -> UserList)');\n      });\n      it('should not throw when instantiating a sync binding with a resolved async dependency', inject([AsyncTestCompleter], (async) => {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers), UserController]);\n        injector.asyncGet(UserList).then((_) => {\n          expect(() => {\n            injector.get(UserController);\n          }).not.toThrow();\n          async.done();\n        });\n      }));\n      it('should resolve synchronously when an async dependency requested as a promise', function() {\n        var injector = Injector.resolveAndCreate([bind(UserList).toAsyncFactory(fetchUsers), AsyncUserController]);\n        var controller = injector.get(AsyncUserController);\n        expect(controller).toBeAnInstanceOf(AsyncUserController);\n        expect(controller.userList).toBePromise();\n      });\n      it('should wrap sync dependencies into promises if required', function() {\n        var injector = Injector.resolveAndCreate([bind(UserList).toFactory(() => new UserList()), AsyncUserController]);\n        var controller = injector.get(AsyncUserController);\n        expect(controller).toBeAnInstanceOf(AsyncUserController);\n        expect(controller.userList).toBePromise();\n      });\n    });\n  });\n}\n//# sourceMappingURL=async_spec.js.map\n\n//# sourceMappingURL=./async_spec.map"]}