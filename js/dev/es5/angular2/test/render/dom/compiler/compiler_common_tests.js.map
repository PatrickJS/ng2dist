{"version":3,"sources":["compiler_common_tests.es6"],"names":[],"mappings":"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","file":"angular2/test/render/dom/compiler/compiler_common_tests.js","sourcesContent":["import {assert} from \"rtts_assert/rtts_assert\";\nimport {AsyncTestCompleter,\n  beforeEach,\n  ddescribe,\n  describe,\n  el,\n  expect,\n  iit,\n  inject,\n  IS_DARTIUM,\n  it} from 'angular2/test_lib';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\nimport {List,\n  ListWrapper,\n  Map,\n  MapWrapper,\n  StringMapWrapper} from 'angular2/src/facade/collection';\nimport {Type,\n  isBlank,\n  stringify,\n  isPresent} from 'angular2/src/facade/lang';\nimport {PromiseWrapper,\n  Promise} from 'angular2/src/facade/async';\nimport {Compiler,\n  CompilerCache} from 'angular2/src/render/dom/compiler/compiler';\nimport {ProtoViewDto,\n  ViewDefinition} from 'angular2/src/render/api';\nimport {CompileElement} from 'angular2/src/render/dom/compiler/compile_element';\nimport {CompileStep} from 'angular2/src/render/dom/compiler/compile_step';\nimport {CompileStepFactory} from 'angular2/src/render/dom/compiler/compile_step_factory';\nimport {CompileControl} from 'angular2/src/render/dom/compiler/compile_control';\nimport {TemplateLoader} from 'angular2/src/render/dom/compiler/template_loader';\nimport {UrlResolver} from 'angular2/src/services/url_resolver';\nexport function runCompilerCommonTests() {\n  describe('compiler', function() {\n    var mockStepFactory;\n    function createCompiler(processClosure, urlData = null) {\n      if (isBlank(urlData)) {\n        urlData = MapWrapper.create();\n      }\n      var tplLoader = new FakeTemplateLoader(urlData);\n      mockStepFactory = new MockStepFactory([new MockStep(processClosure)]);\n      return new Compiler(mockStepFactory, tplLoader);\n    }\n    it('should run the steps and build the AppProtoView of the root element', inject([AsyncTestCompleter], (async) => {\n      var compiler = createCompiler((parent, current, control) => {\n        current.inheritedProtoView.bindVariable('b', 'a');\n      });\n      compiler.compile(new ViewDefinition({\n        componentId: 'someComponent',\n        template: '<div></div>'\n      })).then((protoView) => {\n        expect(protoView.variableBindings).toEqual(MapWrapper.createFromStringMap({'a': 'b'}));\n        async.done();\n      });\n    }));\n    it('should use the inline template and compile in sync', inject([AsyncTestCompleter], (async) => {\n      var compiler = createCompiler(EMPTY_STEP);\n      compiler.compile(new ViewDefinition({\n        componentId: 'someId',\n        template: 'inline component'\n      })).then((protoView) => {\n        expect(DOM.getInnerHTML(protoView.render.delegate.element)).toEqual('inline component');\n        async.done();\n      });\n    }));\n    it('should load url templates', inject([AsyncTestCompleter], (async) => {\n      var urlData = MapWrapper.createFromStringMap({'someUrl': 'url component'});\n      var compiler = createCompiler(EMPTY_STEP, urlData);\n      compiler.compile(new ViewDefinition({\n        componentId: 'someId',\n        absUrl: 'someUrl'\n      })).then((protoView) => {\n        expect(DOM.getInnerHTML(protoView.render.delegate.element)).toEqual('url component');\n        async.done();\n      });\n    }));\n    it('should report loading errors', inject([AsyncTestCompleter], (async) => {\n      var compiler = createCompiler(EMPTY_STEP, MapWrapper.create());\n      PromiseWrapper.catchError(compiler.compile(new ViewDefinition({\n        componentId: 'someId',\n        absUrl: 'someUrl'\n      })), (e) => {\n        expect(e.message).toContain(`Failed to load the template \"someId\"`);\n        async.done();\n      });\n    }));\n    it('should wait for async subtasks to be resolved', inject([AsyncTestCompleter], (async) => {\n      var subTasksCompleted = false;\n      var completer = PromiseWrapper.completer();\n      var compiler = createCompiler((parent, current, control) => {\n        ListWrapper.push(mockStepFactory.subTaskPromises, completer.promise.then((_) => {\n          subTasksCompleted = true;\n        }));\n      });\n      var pvPromise = compiler.compile(new ViewDefinition({\n        componentId: 'someId',\n        template: 'some component'\n      }));\n      expect(pvPromise).toBePromise();\n      expect(subTasksCompleted).toEqual(false);\n      completer.resolve(null);\n      pvPromise.then((protoView) => {\n        expect(subTasksCompleted).toEqual(true);\n        async.done();\n      });\n    }));\n  });\n}\nclass MockStepFactory extends CompileStepFactory {\n  constructor(steps) {\n    super();\n    this.steps = steps;\n  }\n  createSteps(template, subTaskPromises) {\n    this.subTaskPromises = subTaskPromises;\n    ListWrapper.forEach(this.subTaskPromises, (p) => ListWrapper.push(subTaskPromises, p));\n    return this.steps;\n  }\n}\nclass MockStep extends CompileStep {\n  constructor(process) {\n    super();\n    this.processClosure = process;\n  }\n  process(parent, current, control) {\n    assert.argumentTypes(parent, CompileElement, current, CompileElement, control, CompileControl);\n    this.processClosure(parent, current, control);\n  }\n}\nObject.defineProperty(MockStep.prototype.process, \"parameters\", {get: function() {\n    return [[CompileElement], [CompileElement], [CompileControl]];\n  }});\nvar EMPTY_STEP = (parent, current, control) => {\n  if (isPresent(parent)) {\n    current.inheritedProtoView = parent.inheritedProtoView;\n  }\n};\nclass FakeTemplateLoader extends TemplateLoader {\n  constructor(urlData) {\n    super(null, new UrlResolver());\n    this._urlData = urlData;\n  }\n  load(template) {\n    assert.argumentTypes(template, ViewDefinition);\n    if (isPresent(template.template)) {\n      return PromiseWrapper.resolve(DOM.createTemplate(template.template));\n    }\n    if (isPresent(template.absUrl)) {\n      var content = MapWrapper.get(this._urlData, template.absUrl);\n      if (isPresent(content)) {\n        return PromiseWrapper.resolve(DOM.createTemplate(content));\n      }\n    }\n    return PromiseWrapper.reject('Load failed');\n  }\n}\nObject.defineProperty(FakeTemplateLoader.prototype.load, \"parameters\", {get: function() {\n    return [[ViewDefinition]];\n  }});\n//# sourceMappingURL=compiler_common_tests.js.map\n\n//# sourceMappingURL=./compiler_common_tests.map"]}