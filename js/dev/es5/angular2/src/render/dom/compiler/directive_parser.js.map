{"version":3,"sources":["directive_parser.es6"],"names":[],"mappings":"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","file":"angular2/src/render/dom/compiler/directive_parser.js","sourcesContent":["import {assert} from \"rtts_assert/rtts_assert\";\nimport {isPresent,\n  isBlank,\n  BaseException,\n  assertionsEnabled,\n  RegExpWrapper,\n  StringWrapper} from 'angular2/src/facade/lang';\nimport {List,\n  MapWrapper,\n  ListWrapper} from 'angular2/src/facade/collection';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\nimport {Parser} from 'angular2/change_detection';\nimport {SelectorMatcher,\n  CssSelector} from 'angular2/src/render/dom/compiler/selector';\nimport {CompileStep} from './compile_step';\nimport {CompileElement} from './compile_element';\nimport {CompileControl} from './compile_control';\nimport {DirectiveMetadata} from '../../api';\nimport {dashCaseToCamelCase,\n  camelCaseToDashCase,\n  EVENT_TARGET_SEPARATOR} from '../util';\nexport class DirectiveParser extends CompileStep {\n  constructor(parser, directives) {\n    assert.argumentTypes(parser, Parser, directives, assert.genericType(List, DirectiveMetadata));\n    super();\n    this._parser = parser;\n    this._selectorMatcher = new SelectorMatcher();\n    this._directives = directives;\n    for (var i = 0; i < directives.length; i++) {\n      var selector = CssSelector.parse(directives[i].selector);\n      this._selectorMatcher.addSelectables(selector, i);\n    }\n  }\n  process(parent, current, control) {\n    assert.argumentTypes(parent, CompileElement, current, CompileElement, control, CompileControl);\n    var attrs = current.attrs();\n    var classList = current.classList();\n    var cssSelector = new CssSelector();\n    var nodeName = DOM.nodeName(current.element);\n    cssSelector.setElement(nodeName);\n    for (var i = 0; i < classList.length; i++) {\n      cssSelector.addClassName(classList[i]);\n    }\n    MapWrapper.forEach(attrs, (attrValue, attrName) => {\n      cssSelector.addAttribute(attrName, attrValue);\n    });\n    var viewportDirective;\n    var componentDirective;\n    var isTemplateElement = DOM.isTemplateElement(current.element);\n    this._selectorMatcher.match(cssSelector, (selector, directiveIndex) => {\n      var elementBinder = current.bindElement();\n      var directive = this._directives[directiveIndex];\n      var directiveBinder = elementBinder.bindDirective(directiveIndex);\n      current.compileChildren = current.compileChildren && directive.compileChildren;\n      if (isPresent(directive.properties)) {\n        MapWrapper.forEach(directive.properties, (bindConfig, dirProperty) => {\n          this._bindDirectiveProperty(dirProperty, bindConfig, current, directiveBinder);\n        });\n      }\n      if (isPresent(directive.hostListeners)) {\n        MapWrapper.forEach(directive.hostListeners, (action, eventName) => {\n          this._bindDirectiveEvent(eventName, action, current, directiveBinder);\n        });\n      }\n      if (isPresent(directive.setters)) {\n        ListWrapper.forEach(directive.setters, (propertyName) => {\n          elementBinder.bindPropertySetter(propertyName);\n        });\n      }\n      if (isPresent(directive.readAttributes)) {\n        ListWrapper.forEach(directive.readAttributes, (attrName) => {\n          elementBinder.readAttribute(attrName);\n        });\n      }\n      if (directive.type === DirectiveMetadata.VIEWPORT_TYPE) {\n        if (!isTemplateElement) {\n          throw new BaseException(`Viewport directives need to be placed on <template> elements or elements ` + `with template attribute - check ${current.elementDescription}`);\n        }\n        if (isPresent(viewportDirective)) {\n          throw new BaseException(`Only one viewport directive is allowed per element - check ${current.elementDescription}`);\n        }\n        viewportDirective = directive;\n      } else {\n        if (isTemplateElement) {\n          throw new BaseException(`Only template directives are allowed on template elements - check ${current.elementDescription}`);\n        }\n        if (directive.type === DirectiveMetadata.COMPONENT_TYPE) {\n          if (isPresent(componentDirective)) {\n            throw new BaseException(`Only one component directive is allowed per element - check ${current.elementDescription}`);\n          }\n          componentDirective = directive;\n          elementBinder.setComponentId(directive.id);\n        }\n      }\n    });\n  }\n  _bindDirectiveProperty(dirProperty, bindConfig, compileElement, directiveBinder) {\n    var pipes = this._splitBindConfig(bindConfig);\n    var elProp = ListWrapper.removeAt(pipes, 0);\n    var bindingAst = MapWrapper.get(compileElement.bindElement().propertyBindings, dashCaseToCamelCase(elProp));\n    if (isBlank(bindingAst)) {\n      var attributeValue = MapWrapper.get(compileElement.attrs(), camelCaseToDashCase(elProp));\n      if (isPresent(attributeValue)) {\n        bindingAst = this._parser.wrapLiteralPrimitive(attributeValue, compileElement.elementDescription);\n      }\n    }\n    if (isPresent(bindingAst)) {\n      var fullExpAstWithBindPipes = this._parser.addPipes(bindingAst, pipes);\n      directiveBinder.bindProperty(dirProperty, fullExpAstWithBindPipes);\n    }\n  }\n  _bindDirectiveEvent(eventName, action, compileElement, directiveBinder) {\n    var ast = this._parser.parseAction(action, compileElement.elementDescription);\n    if (StringWrapper.contains(eventName, EVENT_TARGET_SEPARATOR)) {\n      var parts = eventName.split(EVENT_TARGET_SEPARATOR);\n      directiveBinder.bindEvent(parts[1], ast, parts[0]);\n    } else {\n      directiveBinder.bindEvent(eventName, ast);\n    }\n  }\n  _splitBindConfig(bindConfig) {\n    return ListWrapper.map(bindConfig.split('|'), (s) => s.trim());\n  }\n}\nObject.defineProperty(DirectiveParser, \"parameters\", {get: function() {\n    return [[Parser], [assert.genericType(List, DirectiveMetadata)]];\n  }});\nObject.defineProperty(DirectiveParser.prototype.process, \"parameters\", {get: function() {\n    return [[CompileElement], [CompileElement], [CompileControl]];\n  }});\nObject.defineProperty(DirectiveParser.prototype._splitBindConfig, \"parameters\", {get: function() {\n    return [[assert.type.string]];\n  }});\n//# sourceMappingURL=directive_parser.js.map\n\n//# sourceMappingURL=./directive_parser.map"]}