{"version":3,"sources":["view_factory.es6"],"names":[],"mappings":"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","file":"angular2/src/core/compiler/view_factory.js","sourcesContent":["import {assert} from \"rtts_assert/rtts_assert\";\nimport {Injectable,\n  Inject,\n  OpaqueToken} from 'angular2/di';\nimport {ListWrapper,\n  MapWrapper,\n  Map,\n  StringMapWrapper,\n  List} from 'angular2/src/facade/collection';\nimport * as eli from './element_injector';\nimport {isPresent,\n  isBlank,\n  BaseException} from 'angular2/src/facade/lang';\nimport {NgElement} from 'angular2/src/core/compiler/ng_element';\nimport * as vcModule from './view_container';\nimport * as viewModule from './view';\nimport {BindingPropagationConfig} from 'angular2/change_detection';\nexport const VIEW_POOL_CAPACITY = 'ViewFactory.viewPoolCapacity';\nexport class ViewFactory {\n  constructor(poolCapacityPerProtoView) {\n    this._poolCapacityPerProtoView = poolCapacityPerProtoView;\n    this._pooledViewsPerProtoView = MapWrapper.create();\n  }\n  getView(protoView) {\n    assert.argumentTypes(protoView, viewModule.AppProtoView);\n    var pooledViews = MapWrapper.get(this._pooledViewsPerProtoView, protoView);\n    if (isPresent(pooledViews)) {\n      var result = ListWrapper.removeLast(pooledViews);\n      if (pooledViews.length === 0) {\n        MapWrapper.delete(this._pooledViewsPerProtoView, protoView);\n      }\n      return assert.returnType((result), viewModule.AppView);\n    }\n    return assert.returnType((this._createView(protoView)), viewModule.AppView);\n  }\n  returnView(view) {\n    assert.argumentTypes(view, viewModule.AppView);\n    if (view.hydrated()) {\n      throw new BaseException('Only dehydrated Views can be put back into the pool!');\n    }\n    var protoView = view.proto;\n    var pooledViews = MapWrapper.get(this._pooledViewsPerProtoView, protoView);\n    if (isBlank(pooledViews)) {\n      pooledViews = [];\n      MapWrapper.set(this._pooledViewsPerProtoView, protoView, pooledViews);\n    }\n    if (pooledViews.length < this._poolCapacityPerProtoView) {\n      ListWrapper.push(pooledViews, view);\n    }\n  }\n  _createView(protoView) {\n    assert.argumentTypes(protoView, viewModule.AppProtoView);\n    var view = new viewModule.AppView(protoView, protoView.protoLocals);\n    var changeDetector = protoView.protoChangeDetector.instantiate(view, protoView.bindings, protoView.getVariableBindings(), protoView.getdirectiveRecords());\n    var binders = protoView.elementBinders;\n    var elementInjectors = ListWrapper.createFixedSize(binders.length);\n    var rootElementInjectors = [];\n    var preBuiltObjects = ListWrapper.createFixedSize(binders.length);\n    var viewContainers = ListWrapper.createFixedSize(binders.length);\n    var componentChildViews = [];\n    for (var binderIdx = 0; binderIdx < binders.length; binderIdx++) {\n      var binder = binders[binderIdx];\n      var elementInjector = null;\n      var protoElementInjector = binder.protoElementInjector;\n      if (isPresent(protoElementInjector)) {\n        if (isPresent(protoElementInjector.parent)) {\n          var parentElementInjector = elementInjectors[protoElementInjector.parent.index];\n          elementInjector = protoElementInjector.instantiate(parentElementInjector);\n        } else {\n          elementInjector = protoElementInjector.instantiate(null);\n          ListWrapper.push(rootElementInjectors, elementInjector);\n        }\n      }\n      elementInjectors[binderIdx] = elementInjector;\n      var bindingPropagationConfig = null;\n      if (isPresent(binder.nestedProtoView) && isPresent(binder.componentDirective)) {\n        var childView = this._createView(binder.nestedProtoView);\n        changeDetector.addChild(childView.changeDetector);\n        bindingPropagationConfig = new BindingPropagationConfig(childView.changeDetector);\n        ListWrapper.push(componentChildViews, childView);\n      }\n      var viewContainer = null;\n      if (isPresent(binder.viewportDirective)) {\n        viewContainer = new vcModule.ViewContainer(this, view, binder.nestedProtoView, elementInjector);\n      }\n      viewContainers[binderIdx] = viewContainer;\n      if (isPresent(elementInjector)) {\n        preBuiltObjects[binderIdx] = new eli.PreBuiltObjects(view, new NgElement(view, binderIdx), viewContainer, bindingPropagationConfig);\n      }\n    }\n    view.init(changeDetector, elementInjectors, rootElementInjectors, viewContainers, preBuiltObjects, componentChildViews);\n    return assert.returnType((view), viewModule.AppView);\n  }\n}\nObject.defineProperty(ViewFactory, \"annotations\", {get: function() {\n    return [new Injectable()];\n  }});\nObject.defineProperty(ViewFactory, \"parameters\", {get: function() {\n    return [[new Inject(VIEW_POOL_CAPACITY)]];\n  }});\nObject.defineProperty(ViewFactory.prototype.getView, \"parameters\", {get: function() {\n    return [[viewModule.AppProtoView]];\n  }});\nObject.defineProperty(ViewFactory.prototype.returnView, \"parameters\", {get: function() {\n    return [[viewModule.AppView]];\n  }});\nObject.defineProperty(ViewFactory.prototype._createView, \"parameters\", {get: function() {\n    return [[viewModule.AppProtoView]];\n  }});\n//# sourceMappingURL=view_factory.js.map\n\n//# sourceMappingURL=./view_factory.map"]}