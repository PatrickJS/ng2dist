{"version":3,"sources":["event_manager_spec.js"],"names":[],"mappings":"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","file":"angular2/test/render/dom/events/event_manager_spec.es6","sourcesContent":["import {describe, ddescribe, it, iit, xit, xdescribe, expect, beforeEach, el} from 'angular2/test_lib';\nimport {EventManager, EventManagerPlugin, DomEventsPlugin} from 'angular2/src/render/dom/events/event_manager';\nimport {VmTurnZone} from 'angular2/src/core/zone/vm_turn_zone';\nimport {List, ListWrapper, Map, MapWrapper} from 'angular2/src/facade/collection';\nimport {document} from 'angular2/src/facade/browser';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nexport function main() {\n  var domEventPlugin;\n\n  beforeEach(() => {\n    domEventPlugin = new DomEventsPlugin();\n  });\n\n  describe('EventManager', () => {\n\n    it('should delegate event bindings to plugins', () => {\n      var element = el('<div></div>');\n      var handler = (e) => e;\n      var plugin = new FakeEventManagerPlugin(['click']);\n      var manager = new EventManager([plugin, domEventPlugin], new FakeVmTurnZone());\n      manager.addEventListener(element, 'click', handler);\n      expect(MapWrapper.get(plugin._nonBubbleEventHandlers, 'click')).toBe(handler);\n    });\n\n    it('should delegate bubbling events to plugins', () => {\n      var element = el('<div></div>');\n      var handler = (e) => e;\n      var plugin = new FakeEventManagerPlugin(['click']);\n      var manager = new EventManager([plugin, domEventPlugin], new FakeVmTurnZone());\n      manager.addEventListener(element, '^click', handler);\n      expect(MapWrapper.get(plugin._bubbleEventHandlers, 'click')).toBe(handler);\n    });\n\n    it('should delegate event bindings to the first plugin supporting the event', () => {\n      var element = el('<div></div>');\n      var clickHandler = (e) => e;\n      var dblClickHandler = (e) => e;\n      var plugin1= new FakeEventManagerPlugin(['dblclick']);\n      var plugin2 = new FakeEventManagerPlugin(['click', 'dblclick']);\n      var manager = new EventManager([plugin1, plugin2], new FakeVmTurnZone());\n      manager.addEventListener(element, 'click', clickHandler);\n      manager.addEventListener(element, 'dblclick', dblClickHandler);\n      expect(MapWrapper.contains(plugin1._nonBubbleEventHandlers, 'click')).toBe(false);\n      expect(MapWrapper.get(plugin2._nonBubbleEventHandlers, 'click')).toBe(clickHandler);\n      expect(MapWrapper.contains(plugin2._nonBubbleEventHandlers, 'dblclick')).toBe(false);\n      expect(MapWrapper.get(plugin1._nonBubbleEventHandlers, 'dblclick')).toBe(dblClickHandler);\n    });\n\n    it('should throw when no plugin can handle the event', () => {\n      var element = el('<div></div>');\n      var plugin = new FakeEventManagerPlugin(['dblclick']);\n      var manager = new EventManager([plugin], new FakeVmTurnZone());\n      expect(() => manager.addEventListener(element, 'click', null))\n        .toThrowError('No event manager plugin found for event click');\n    });\n\n    it('by default events are only caught on same element', () => {\n      var element = el('<div><div></div></div>');\n      var child = DOM.firstChild(element);\n      var dispatchedEvent = DOM.createMouseEvent('click');\n      var receivedEvent = null;\n      var handler = (e) => { receivedEvent = e; };\n      var manager = new EventManager([domEventPlugin], new FakeVmTurnZone());\n      manager.addEventListener(element, 'click', handler);\n      DOM.dispatchEvent(child, dispatchedEvent);\n\n      expect(receivedEvent).toBe(null);\n    });\n\n    it('bubbled events are caught when fired from a child', () => {\n      var element = el('<div><div></div></div>');\n      // Workaround for https://bugs.webkit.org/show_bug.cgi?id=122755\n      DOM.appendChild(document.body, element);\n\n      var child = DOM.firstChild(element);\n      var dispatchedEvent = DOM.createMouseEvent('click');\n      var receivedEvent = null;\n      var handler = (e) => { receivedEvent = e; };\n      var manager = new EventManager([domEventPlugin], new FakeVmTurnZone());\n      manager.addEventListener(element, '^click', handler);\n      DOM.dispatchEvent(child, dispatchedEvent);\n\n      expect(receivedEvent).toBe(dispatchedEvent);\n    });\n\n    it('should add and remove global event listeners with correct bubbling', () => {\n      var element = el('<div><div></div></div>');\n      DOM.appendChild(document.body, element);\n      var dispatchedEvent = DOM.createMouseEvent('click');\n      var receivedEvent = null;\n      var handler = (e) => { receivedEvent = e; };\n      var manager = new EventManager([domEventPlugin], new FakeVmTurnZone());\n\n      var remover = manager.addGlobalEventListener(\"document\", '^click', handler);\n      DOM.dispatchEvent(element, dispatchedEvent);\n      expect(receivedEvent).toBe(dispatchedEvent);\n\n      receivedEvent = null;\n      remover();\n      DOM.dispatchEvent(element, dispatchedEvent);\n      expect(receivedEvent).toBe(null);\n\n      remover = manager.addGlobalEventListener(\"document\", 'click', handler);\n      DOM.dispatchEvent(element, dispatchedEvent);\n      expect(receivedEvent).toBe(null);\n    });\n  });\n}\n\nclass FakeEventManagerPlugin extends EventManagerPlugin {\n  _supports: List<string>;\n  _nonBubbleEventHandlers: Map;\n  _bubbleEventHandlers: Map;\n  constructor(supports: List<string>) {\n    super();\n    this._supports = supports;\n    this._nonBubbleEventHandlers = MapWrapper.create();\n    this._bubbleEventHandlers = MapWrapper.create();\n  }\n\n  supports(eventName: string): boolean {\n    return ListWrapper.contains(this._supports, eventName);\n  }\n\n  addEventListener(element, eventName: string, handler: Function, shouldSupportBubble: boolean) {\n    MapWrapper.set(shouldSupportBubble ? this._bubbleEventHandlers : this._nonBubbleEventHandlers,\n        eventName, handler);\n    return () => {MapWrapper.delete(shouldSupportBubble ? this._bubbleEventHandlers : this._nonBubbleEventHandlers,\n        eventName)};\n  }\n}\n\nclass FakeVmTurnZone extends VmTurnZone {\n  constructor() {\n    super({enableLongStackTrace: false});\n  }\n\n  run(fn) {\n    fn();\n  }\n\n  runOutsideAngular(fn) {\n    return fn();\n  }\n}\n"]}