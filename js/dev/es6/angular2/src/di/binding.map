{"version":3,"sources":["binding.js"],"names":[],"mappings":"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","file":"angular2/src/di/binding.es6","sourcesContent":["import {Type, isBlank, isPresent, CONST} from 'angular2/src/facade/lang';\nimport {List, MapWrapper, ListWrapper} from 'angular2/src/facade/collection';\nimport {reflector} from 'angular2/src/reflection/reflection';\nimport {Key} from './key';\nimport {Inject, InjectLazy, InjectPromise, Optional, DependencyAnnotation} from './annotations';\nimport {NoAnnotationError} from './exceptions';\n\nexport class Dependency {\n  key:Key;\n  asPromise:boolean;\n  lazy:boolean;\n  optional:boolean;\n  properties:List;\n\n  constructor(key:Key, asPromise:boolean, lazy:boolean, optional:boolean, properties:List) {\n    this.key = key;\n    this.asPromise = asPromise;\n    this.lazy = lazy;\n    this.optional = optional;\n    this.properties = properties;\n  }\n\n  static fromKey(key:Key) {\n    return new Dependency(key, false, false, false, []);\n  }\n}\n\nvar _EMPTY_LIST = [];  // TODO: make const when supported\n\n/**\n * Declaration of a dependency binding.\n */\nexport class Binding {\n  token;\n  toClass:Type;\n  toValue;\n  toAlias;\n  toFactory:Function;\n  toAsyncFactory:Function;\n  dependencies:List;\n\n  @CONST()\n  constructor(\n      token,\n      {\n        toClass,\n        toValue,\n        toAlias,\n        toFactory,\n        toAsyncFactory,\n        deps\n      }) {\n    this.token = token;\n    this.toClass = toClass;\n    this.toValue = toValue;\n    this.toAlias = toAlias;\n    this.toFactory = toFactory;\n    this.toAsyncFactory = toAsyncFactory;\n    this.dependencies = deps;\n  }\n\n  resolve(): ResolvedBinding {\n    var factoryFn:Function;\n    var resolvedDeps;\n    var isAsync = false;\n    if (isPresent(this.toClass)) {\n      factoryFn = reflector.factory(this.toClass);\n      resolvedDeps = _dependenciesFor(this.toClass);\n    } else if (isPresent(this.toAlias)) {\n      factoryFn = (aliasInstance) => aliasInstance;\n      resolvedDeps = [Dependency.fromKey(Key.get(this.toAlias))];\n    } else if (isPresent(this.toFactory)) {\n      factoryFn = this.toFactory;\n      resolvedDeps = _constructDependencies(this.toFactory, this.dependencies);\n    } else if (isPresent(this.toAsyncFactory)) {\n      factoryFn = this.toAsyncFactory;\n      resolvedDeps = _constructDependencies(this.toAsyncFactory, this.dependencies);\n      isAsync = true;\n    } else {\n      factoryFn = () => this.toValue;\n      resolvedDeps = _EMPTY_LIST;\n    }\n\n    return new ResolvedBinding(\n      Key.get(this.token),\n      factoryFn,\n      resolvedDeps,\n      isAsync\n    );\n  }\n}\n\n/// Dependency binding with resolved keys and dependencies.\nexport class ResolvedBinding {\n  key:Key;\n  factory:Function;\n  dependencies:List<Dependency>;\n  providedAsPromise:boolean;\n\n  constructor(key:Key, factory:Function, dependencies:List<Dependency>, providedAsPromise:boolean) {\n    this.key = key;\n    this.factory = factory;\n    this.dependencies = dependencies;\n    this.providedAsPromise = providedAsPromise;\n  }\n}\n\n/**\n * Provides fluent API for imperative construction of [Binding] objects.\n */\nexport function bind(token):BindingBuilder {\n  return new BindingBuilder(token);\n}\n\n/**\n * Helper class for [bind] function.\n */\nexport class BindingBuilder {\n  token;\n\n  constructor(token) {\n    this.token = token;\n  }\n\n  toClass(type:Type):Binding {\n    return new Binding(this.token, {toClass: type});\n  }\n\n  toValue(value):Binding {\n    return new Binding(this.token, {toValue: value});\n  }\n\n  toAlias(aliasToken):Binding {\n    return new Binding(this.token, {toAlias: aliasToken});\n  }\n\n  toFactory(factoryFunction:Function, dependencies:List = null):Binding {\n    return new Binding(this.token, {\n      toFactory: factoryFunction,\n      deps: dependencies\n    });\n  }\n\n  toAsyncFactory(factoryFunction:Function, dependencies:List = null):Binding {\n    return new Binding(this.token, {\n      toAsyncFactory: factoryFunction,\n      deps: dependencies\n    });\n  }\n}\n\nfunction _constructDependencies(factoryFunction:Function, dependencies:List) {\n  return isBlank(dependencies) ?\n    _dependenciesFor(factoryFunction) :\n    ListWrapper.map(dependencies, (t) => Dependency.fromKey(Key.get(t)));\n}\n\nfunction _dependenciesFor(typeOrFunc):List {\n  var params = reflector.parameters(typeOrFunc);\n  if (isBlank(params)) return [];\n  if (ListWrapper.any(params, (p) => isBlank(p))) throw new NoAnnotationError(typeOrFunc);\n  return ListWrapper.map(params, (p) => _extractToken(typeOrFunc, p));\n}\n\nfunction _extractToken(typeOrFunc, annotations) {\n  var depProps = [];\n  var token = null;\n  var optional = false;\n  var lazy = false;\n  var asPromise = false;\n\n  for (var i = 0; i < annotations.length; ++i) {\n    var paramAnnotation = annotations[i];\n\n    if (paramAnnotation instanceof Type) {\n      token = paramAnnotation;\n\n    } else if (paramAnnotation instanceof Inject) {\n      token = paramAnnotation.token;\n\n    } else if (paramAnnotation instanceof InjectPromise) {\n      token = paramAnnotation.token;\n      asPromise = true;\n\n    } else if (paramAnnotation instanceof InjectLazy) {\n      token = paramAnnotation.token;\n      lazy = true;\n\n    } else if (paramAnnotation instanceof Optional) {\n      optional = true;\n\n    } else if (paramAnnotation instanceof DependencyAnnotation) {\n      if (isPresent(paramAnnotation.token)) {\n       token = paramAnnotation.token;\n      }\n      ListWrapper.push(depProps, paramAnnotation);\n\n    }\n  }\n\n  if (isPresent(token)) {\n    return _createDependency(token, asPromise, lazy, optional, depProps);\n  } else {\n    throw new NoAnnotationError(typeOrFunc);\n  }\n}\n\nfunction _createDependency(token, asPromise, lazy, optional, depProps):Dependency {\n  return new Dependency(Key.get(token), asPromise, lazy, optional, depProps);\n}\n"]}