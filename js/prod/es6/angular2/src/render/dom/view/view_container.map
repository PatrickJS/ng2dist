{"version":3,"sources":["view_container.js"],"names":[],"mappings":"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","file":"angular2/src/render/dom/view/view_container.es6","sourcesContent":["import {isPresent, isBlank, BaseException} from 'angular2/src/facade/lang';\nimport {ListWrapper, MapWrapper, List} from 'angular2/src/facade/collection';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nimport * as viewModule from './view';\nimport * as ldModule from '../shadow_dom/light_dom';\nimport * as vfModule from './view_factory';\n\nexport class ViewContainer {\n  _viewFactory: vfModule.ViewFactory;\n  templateElement;\n  _views: List<viewModule.RenderView>;\n  _lightDom: ldModule.LightDom;\n  _hostLightDom: ldModule.LightDom;\n  _hydrated: boolean;\n\n  constructor(viewFactory: vfModule.ViewFactory,\n              templateElement) {\n    this._viewFactory = viewFactory;\n    this.templateElement = templateElement;\n\n    // The order in this list matches the DOM order.\n    this._views = [];\n    this._hostLightDom = null;\n    this._hydrated = false;\n  }\n\n  hydrate(destLightDom: ldModule.LightDom, hostLightDom: ldModule.LightDom) {\n    this._hydrated = true;\n    this._hostLightDom = hostLightDom;\n    this._lightDom = destLightDom;\n  }\n\n  dehydrate() {\n    if (isBlank(this._lightDom)) {\n      for (var i = this._views.length - 1; i >= 0; i--) {\n        var view = this._views[i];\n        ViewContainer.removeViewNodes(view);\n        this._viewFactory.returnView(view);\n      }\n      this._views = [];\n    } else {\n      for (var i=0; i<this._views.length; i++) {\n        var view = this._views[i];\n        this._viewFactory.returnView(view);\n      }\n      this._views = [];\n      this._lightDom.redistribute();\n    }\n\n    this._hostLightDom = null;\n    this._lightDom = null;\n    this._hydrated = false;\n  }\n\n  get(index: number): viewModule.RenderView {\n    return this._views[index];\n  }\n\n  size() {\n    return this._views.length;\n  }\n\n  _siblingToInsertAfter(index: number) {\n    if (index == 0) return this.templateElement;\n    return ListWrapper.last(this._views[index - 1].rootNodes);\n  }\n\n  _checkHydrated() {\n    if (!this._hydrated) throw new BaseException(\n        'Cannot change dehydrated ViewContainer');\n  }\n\n  insert(view, atIndex=-1): viewModule.RenderView {\n    if (!view.hydrated()) {\n      view.hydrate(this._hostLightDom);\n    }\n    if (atIndex == -1) atIndex = this._views.length;\n    ListWrapper.insert(this._views, atIndex, view);\n\n    if (isBlank(this._lightDom)) {\n      ViewContainer.moveViewNodesAfterSibling(this._siblingToInsertAfter(atIndex), view);\n    } else {\n      this._lightDom.redistribute();\n    }\n    // new content tags might have appeared, we need to redistribute.\n    if (isPresent(this._hostLightDom)) {\n      this._hostLightDom.redistribute();\n    }\n    return view;\n  }\n\n  /**\n   * The method can be used together with insert to implement a view move, i.e.\n   * moving the dom nodes while the directives in the view stay intact.\n   */\n  detach(atIndex:number) {\n    this._checkHydrated();\n    var detachedView = this.get(atIndex);\n    ListWrapper.removeAt(this._views, atIndex);\n    if (isBlank(this._lightDom)) {\n      ViewContainer.removeViewNodes(detachedView);\n    } else {\n      this._lightDom.redistribute();\n    }\n    // content tags might have disappeared we need to do redistribution.\n    if (isPresent(this._hostLightDom)) {\n      this._hostLightDom.redistribute();\n    }\n    return detachedView;\n  }\n\n  contentTagContainers() {\n    return this._views;\n  }\n\n  nodes():List {\n    var r = [];\n    for (var i = 0; i < this._views.length; ++i) {\n      r = ListWrapper.concat(r, this._views[i].rootNodes);\n    }\n    return r;\n  }\n\n\n  static moveViewNodesAfterSibling(sibling, view) {\n    for (var i = view.rootNodes.length - 1; i >= 0; --i) {\n      DOM.insertAfter(sibling, view.rootNodes[i]);\n    }\n  }\n\n  static removeViewNodes(view) {\n    var len = view.rootNodes.length;\n    if (len == 0) return;\n    var parent = view.rootNodes[0].parentNode;\n    for (var i = len - 1; i >= 0; --i) {\n      DOM.removeChild(parent, view.rootNodes[i]);\n    }\n  }\n}\n"]}