{"version":3,"sources":["ios_driver_extension_spec.js"],"names":[],"mappings":"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","file":"benchpress/test/webdriver/ios_driver_extension_spec.es6","sourcesContent":["import {\n  afterEach,\n  AsyncTestCompleter,\n  beforeEach,\n  ddescribe,\n  describe,\n  expect,\n  iit,\n  inject,\n  it,\n  xit,\n} from 'angular2/test_lib';\n\nimport { ListWrapper } from 'angular2/src/facade/collection';\nimport { PromiseWrapper } from 'angular2/src/facade/async';\nimport { Json, isBlank, isPresent } from 'angular2/src/facade/lang';\n\nimport {\n  WebDriverExtension, IOsDriverExtension,\n  WebDriverAdapter, Injector, bind\n} from 'benchpress/common';\n\nimport { TraceEventFactory } from '../trace_event_factory';\n\nexport function main() {\n  describe('ios driver extension', () => {\n    var log;\n    var extension;\n\n    var normEvents = new TraceEventFactory('timeline', 'pid0');\n\n    function createExtension(perfRecords = null) {\n      if (isBlank(perfRecords)) {\n        perfRecords = [];\n      }\n      log = [];\n      extension = Injector.resolveAndCreate([\n        IOsDriverExtension.BINDINGS,\n        bind(WebDriverAdapter).toValue(new MockDriverAdapter(log, perfRecords))\n      ]).get(IOsDriverExtension);\n      return extension;\n    }\n\n    it('should throw on forcing gc', () => {\n      expect( () => createExtension().gc() ).toThrowError('Force GC is not supported on iOS');\n    });\n\n    it('should mark the timeline via console.time()', inject([AsyncTestCompleter], (async) => {\n      createExtension().timeBegin('someName').then( (_) => {\n        expect(log).toEqual([['executeScript', `console.time('someName');`]]);\n        async.done();\n      });\n    }));\n\n    it('should mark the timeline via console.timeEnd()', inject([AsyncTestCompleter], (async) => {\n      createExtension().timeEnd('someName').then( (_) => {\n        expect(log).toEqual([['executeScript', `console.timeEnd('someName');`]]);\n        async.done();\n      });\n    }));\n\n    it('should mark the timeline via console.time() and console.timeEnd()', inject([AsyncTestCompleter], (async) => {\n      createExtension().timeEnd('name1', 'name2').then( (_) => {\n        expect(log).toEqual([['executeScript', `console.timeEnd('name1');console.time('name2');`]]);\n        async.done();\n      });\n    }));\n\n    describe('readPerfLog', () => {\n\n      it('should execute a dummy script before reading them', inject([AsyncTestCompleter], (async) => {\n        // TODO(tbosch): This seems to be a bug in ChromeDriver:\n        // Sometimes it does not report the newest events of the performance log\n        // to the WebDriver client unless a script is executed...\n        createExtension([]).readPerfLog().then( (_) => {\n          expect(log).toEqual([ [ 'executeScript', '1+1' ], [ 'logs', 'performance' ] ]);\n          async.done();\n        });\n      }));\n\n      it('should report FunctionCall records as \"script\"', inject([AsyncTestCompleter], (async) => {\n        createExtension([\n          durationRecord('FunctionCall', 1, 5)\n        ]).readPerfLog().then( (events) => {\n          expect(events).toEqual([\n            normEvents.start('script', 1),\n            normEvents.end('script', 5)\n          ]);\n          async.done();\n        });\n      }));\n\n      it('should ignore FunctionCalls from webdriver', inject([AsyncTestCompleter], (async) => {\n        createExtension([\n          internalScriptRecord(1, 5)\n        ]).readPerfLog().then( (events) => {\n          expect(events).toEqual([]);\n          async.done();\n        });\n      }));\n\n      it('should report begin time', inject([AsyncTestCompleter], (async) => {\n        createExtension([\n          timeBeginRecord('someName', 12)\n        ]).readPerfLog().then( (events) => {\n          expect(events).toEqual([\n            normEvents.markStart('someName', 12)\n          ]);\n          async.done();\n        });\n      }));\n\n      it('should report end timestamps', inject([AsyncTestCompleter], (async) => {\n        createExtension([\n          timeEndRecord('someName', 12)\n        ]).readPerfLog().then( (events) => {\n          expect(events).toEqual([\n            normEvents.markEnd('someName', 12)\n          ]);\n          async.done();\n        });\n      }));\n\n      ['RecalculateStyles', 'Layout', 'UpdateLayerTree', 'Paint', 'Rasterize', 'CompositeLayers'].forEach( (recordType) => {\n        it(`should report ${recordType}`, inject([AsyncTestCompleter], (async) => {\n          createExtension([\n            durationRecord(recordType, 0, 1)\n          ]).readPerfLog().then( (events) => {\n            expect(events).toEqual([\n              normEvents.start('render', 0),\n              normEvents.end('render', 1),\n            ]);\n            async.done();\n          });\n        }));\n      });\n\n\n      it('should walk children', inject([AsyncTestCompleter], (async) => {\n        createExtension([\n          durationRecord('FunctionCall', 1, 5, [\n            timeBeginRecord('someName', 2)\n          ])\n        ]).readPerfLog().then( (events) => {\n          expect(events).toEqual([\n            normEvents.start('script', 1),\n            normEvents.markStart('someName', 2),\n            normEvents.end('script', 5)\n          ]);\n          async.done();\n        });\n      }));\n\n      it('should match safari browsers', () => {\n        expect(createExtension().supports({\n          'browserName': 'safari'\n        })).toBe(true);\n\n        expect(createExtension().supports({\n          'browserName': 'Safari'\n        })).toBe(true);\n      });\n\n    });\n\n  });\n}\n\nfunction timeBeginRecord(name, time) {\n  return {\n    'type': 'Time',\n    'startTime': time,\n    'data': {\n      'message': name\n    }\n  };\n}\n\nfunction timeEndRecord(name, time) {\n  return {\n    'type': 'TimeEnd',\n    'startTime': time,\n    'data': {\n      'message': name\n    }\n  };\n}\n\nfunction durationRecord(type, startTime, endTime, children = null) {\n  if (isBlank(children)) {\n    children = [];\n  }\n  return {\n    'type': type,\n    'startTime': startTime,\n    'endTime': endTime,\n    'children': children\n  };\n}\n\nfunction internalScriptRecord(startTime, endTime) {\n  return {\n    'type': 'FunctionCall',\n    'startTime': startTime,\n    'endTime': endTime,\n    'data': {\n      'scriptName': 'InjectedScript'\n    }\n  };\n}\n\nclass MockDriverAdapter extends WebDriverAdapter {\n  _log:List;\n  _perfRecords:List;\n  constructor(log, perfRecords) {\n    super();\n    this._log = log;\n    this._perfRecords = perfRecords;\n  }\n\n  executeScript(script) {\n    ListWrapper.push(this._log, ['executeScript', script]);\n    return PromiseWrapper.resolve(null);\n  }\n\n  logs(type) {\n    ListWrapper.push(this._log, ['logs', type]);\n    if (type === 'performance') {\n      return PromiseWrapper.resolve(this._perfRecords.map(function(record) {\n        return {\n          'message': Json.stringify({\n            'message': {\n              'method': 'Timeline.eventRecorded',\n              'params': {\n                'record': record\n              }\n            }\n          })\n        };\n      }));\n    } else {\n      return null;\n    }\n  }\n\n}\n"]}